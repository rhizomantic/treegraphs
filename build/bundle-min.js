var seed,density,render,canvas,editor,area,tickers=new Set,t=0,go=!0,tweenable=["step","turn","size","weight"],graphs=[],def0={props:{render:"curves",renderConfig:{type:"petals",levels:[["#FFCC0088",8],["rgba(255, 0, 0, 0.1)",4]]}},net:{type:"fan",num:35,pos:[500,400],ang:0,step:{ease:"sine",pow:-3,terms:"noise*0.8+t*0.2",min:30,max:480,dur:200},turn:6.28/35,children:[]}},def={props:{render:{levels:[{type:"daisy",stroke:"#00000088",fill:"#00000033",weightMult:0,weightAdd:1}]}},net:[{num:4,type:"fan",mirror:!0,size:72,weight:1,step:300,turn:{min:0,dif:3.14,terms:"ix"},children:[{num:6,type:"fan",mirror:!0,size:36,weight:1,step:{min:100,dif:100,terms:"ix*2",ease:"hill",pow:3},turn:{min:0,dif:3.14,var:1.04,terms:"ix",pow:2,dur:200},children:[]}],pos:[702.5,479]}]};function setup(){(canvas=createCanvas(windowWidth,windowHeight)).parent("container"),background("#FFFFFF"),stroke(0,128),strokeWeight(3),noFill(),smooth(),editor=select("#editor"),area=select("#editor-area"),select("#update").mouseClicked(function(){reset(!0)}),select("#generate").mouseClicked(function(){reset(!1)}),reset(!1),console.log("setup")}function reset(e){let s;s=e?JSON.parse(area.value()):def,background("#FFFFFF"),t=0,seed=int(random(999999)),randomSeed(seed),noiseSeed(seed),graphs=[];var i=new Graph(s);graphs.push(i),area.value(JSON.stringify(s,replacer,2)),render=new RenderCurves(s)}function replacer(e,t){return"number"==typeof t?Math.floor(100*t)/100:t}function draw(){if(go){background("#FFFFFF");for(let e of graphs)e.root.update(),moveNode(e.root),render.render(e.root);t++}}function makeGroup(e,t,s){for(let i=0;i<e.num;i++){let o=new Node;if(o.ix=i,o.nrm=1==e.num?0:1/e.num*i,o.parent=t,o.parent.kids.push(o),o.depth=t.depth+1,o.graph=s,s.count++,s.depth=Math.max(s.depth,o.depth),"chain"==e.type&&i>0?o.anchor=t.kids[i-1]:o.anchor=t,o.type=e.type,o.rot=0,o.turn=e.turn,o.step=e.step,o.mirror=e.mirror,o.size=e.size,o.weight=e.weight,o.fill=e.fill,o.stroke=e.stroke,o.init(),e.children)for(let t=0;t<e.children.length;t++)makeGroup(e.children[t],o,s)}}class Graph{constructor(e={}){this.ix=graphs.length,this.count=0,this.depth=0,this.root=new Node;for(let t=0;t<e.net.length;t++)makeGroup(e.net[t],this.root,this);this.root.init(),console.log("graph",this)}}class Node{constructor(e={}){this.ix=e.ix||0,this.nrm=e.nrm||0,this.rnd=e.rnd||Math.random(),this.pos=e.pos||[windowWidth/2,windowHeight/2],this.step=e.step||30,this.turn=e.turn||0,this.rot=e.rot||0,this.mirror=e.mirror||!1,this.size=e.size||20,this.weight=e.weight||1,this.depth=e.depth||0,this.fill=e.fill||"#888888",this.stroke=e.stroke||0,this.graph=e.graph||null,this.parent=e.parent||null,this.anchor=e.anchor||null,this.kids=e.kids||[],this.curves={}}init(){for(let e of tweenable)isNaN(this[e])&&(this.curves[e]=parseCurve(this[e],this));for(let e of this.kids)e.init()}update(){for(let[e,s]of Object.entries(this.curves)){let i=s.base;if(s.dur>0){let e=floor(t/(s.dur+1))%2==0?t%(s.dur+1):s.dur+1-t%(s.dur+1);i+=1/s.dur*e*s.time}i>1&&(i=0==floor(i%2)?i%1:1-i%1),this[e]=s.min+ease(s.ease,i,s.pow)*s.dif}for(let e of this.kids)e.update()}}function ease(e,t,s){return"simple"==e?s<0?1-Math.pow(1-t,Math.abs(s)):Math.pow(t,Math.abs(s)):"IO"==e?t<.5?.5*(s<0?1-Math.pow(1-2*t,Math.abs(s)):Math.pow(2*t,Math.abs(s))):.5*(1-(s<0?1-Math.pow(1-(1-2*(t-.5)),Math.abs(s)):Math.pow(1-2*(t-.5),Math.abs(s))))+.5:"hill"==e?(t=t<.5?2*t:1-2*(t-.5),s<0?1-Math.pow(1-t,Math.abs(s)):Math.pow(t,Math.abs(s))):"sine"==e?.5*Math.sin(t*s*Math.PI*2)+.5:"noise"==e?noise(16*t):t}function mousePressed(){}function keyTyped(){if(document.activeElement!==document.getElementById("editor-area"))if(" "===key)go=!go,console.log("go",go);else if("r"===key)reset(!1);else if("s"===key){let e=getTime();saveCanvas("collider-"+e+".jpg"),saveJSON(defs,"collider-"+e+".jpg",!1)}else"g"===key?generate():"e"===key&&("block"==editor.style("display")?editor.hide():editor.show())}function contrast(e,t){return constrain(t*(e-.5)+.5,0,1)}function getTime(){let e=new Date;return e.getFullYear().toString().substring(2,4)+(e.getMonth()+1).toString().padStart(2,"0")+e.getDate().toString().padStart(2,"0")+"-"+e.getHours().toString().padStart(2,"0")+e.getMinutes().toString().padStart(2,"0")+e.getSeconds().toString().padStart(2,"0")}function windowResized(){resizeCanvas(windowWidth,windowHeight),canvas.parent("container"),background("#FFFFFF")}function generateWithBudget(){let e=0,t=[PI/2,PI,2*PI],s={props:{render:{levels:[{type:"tree",stroke:"#999999",weightMult:0,weightAdd:1},{type:"bezier",stroke:"#00000088",weightAdd:4},{type:"bezier",stroke:"#FFFFFF88",weight:0}]}},net:[]},i=s.net,o=1;for(;e<160;){let s=Math.floor(10*Math.pow(Math.random(),2))+2;for(;e+o*s>200&&s>1;)s--;let r={num:s,type:Math.random()<.6?"fan":"chain",step:{min:120*Math.random()+30,dif:0},turn:{min:PI/2,dif:t[Math.floor(random(t.length))]},mirror:s%2==0,weight:{min:2,dif:2,terms:"depth"},size:{min:10,dif:40,terms:"depth"},children:[]};i.push(r),e+=o*s,Math.random()<.7&&(i=r.children,o*=s)}return s.net[0].pos=[windowWidth/2,windowHeight/2],s}function generateSimple(){let e=random(.1,PI/2),t={props:{render:{levels:[{type:"petals",stroke:"#00000000",fill:"#00000033",weightMult:0,weightAdd:1}]}},net:[{num:2,type:"fan",mirror:!0,size:72,weight:1,step:30,turn:{min:PI/2+e,dif:4*-e,terms:"ix"},children:[{num:6,type:"fan",mirror:!0,size:36,weight:1,step:{min:100,dif:0,terms:"ix*2",ease:"hill",pow:3},turn:{min:0,var:TWO_PI/6,terms:"t",pow:2,dur:200},children:[{num:24,type:"fan",mirror:!0,size:6,weight:1,step:{min:100,dif:200,terms:"t*0.5+ix*0.5",ease:"hill",pow:3,dur:200},turn:{min:0,dif:random(1,TWO_PI),terms:"ix"},children:[]}]}]}]};return console.log("GEN",e,PI/2+e,4*-e),t.net[0].pos=[windowWidth/2,windowHeight/2],t}function parseCurve(e,t){e.terms=e.terms||"ix";let s={};s.ease=e.ease||"none",s.pow=e.pow||2,s.min=e.min||0,s.dif=e.dif||0,s.dur=e.dur||0,s.base=0,s.time=0;let i=e.terms.split("+");for(let e of i){let i=e.split("*");if("t"==i[0]||"time"==i[0])s.time=i.length>1?parseFloat(i[1]):1;else if("tix"==i[0])s.time=i.length>1?t.nrm*parseFloat(i[1]):t.nrm;else{let e=1;for(let s of i)e*="ix"==s?t.nrm:"rnd"==s?t.rnd:"noise"==s?noise(t.parent.nrm,t.nrm):"dix"==s?t.parent.nrm:"drnd"==s?t.parent.rnd:"depth"==s?t.depth:"idepth"==s?t.graph.depth-t.depth:"depth-nrm"==s?1/t.graph.depth*t.depth:"idepth-nrm"==s?1-1/t.graph.depth*t.depth:parseFloat(s);s.base+=e}}return s}function moveNode(e){if(null!==e.anchor){let t=(null!=e.parent.anchor&&e.parent.mirror&&e.parent.anchor.ix%2==0)^(e.mirror&&e.parent.ix%2==0);e.rot=t?e.parent.rot-e.turn:e.parent.rot+e.turn,e.pos=[e.anchor.pos[0]+e.step*cos(e.rot),e.anchor.pos[1]+e.step*sin(e.rot)]}for(let t of e.kids)moveNode(t)}function drawNode(e){null!=e.anchor&&line(e.anchor.pos[0],e.anchor.pos[1],e.pos[0],e.pos[1]),ellipse(e.pos[0],e.pos[1],10,10);for(let t of e.kids)drawNode(t)}class RenderCurves{constructor(e={}){let t=e.props.render||{};this.type=t.type||"tree",this.levels=t.levels||[{stroke:0,weight:1}];for(let e of this.levels)e.hasOwnProperty("type")||(e.type=this.type),e.hasOwnProperty("stroke")||(e.stroke=0),e.hasOwnProperty("fill")||(e.fill="#888888"),e.hasOwnProperty("weightAdd")||(e.weightAdd=0),e.hasOwnProperty("weightMult")||(e.weightMult=1),e.hasOwnProperty("sizeAdd")||(e.sizeAdd=0),e.hasOwnProperty("sizeMult")||(e.sizeMult=1);console.log("render type",this.type)}render(e){for(let t of this.levels)this.renderNode(e,t)}renderNode(e,t){if(noFill(),noStroke(),"bezier"==t.type){if(e.kids.length>2)for(let s=1;s<e.kids.length-1;s++){let i=[e.kids[s-1].pos[0]+(e.kids[s].pos[0]-e.kids[s-1].pos[0])/2,e.kids[s-1].pos[1]+(e.kids[s].pos[1]-e.kids[s-1].pos[1])/2,e.kids[s].pos[0],e.kids[s].pos[1],e.kids[s].pos[0]+(e.kids[s+1].pos[0]-e.kids[s].pos[0])/2,e.kids[s].pos[1]+(e.kids[s+1].pos[1]-e.kids[s].pos[1])/2];stroke("node"==t.stroke?e.kids[s].stroke:t.stroke),strokeWeight(e.kids[s].weight*t.weightMult+t.weightAdd),bezier(i[0],i[1],i[2],i[3],i[2],i[3],i[4],i[5])}}else if("bezier-closed"==t.type){if(e.kids.length>2)for(let s=0;s<e.kids.length;s++){let i=0==s?e.kids.length-1:s-1,o=s==e.kids.length-1?0:s+1,r=[e.kids[i].pos[0]+(e.kids[s].pos[0]-e.kids[i].pos[0])/2,e.kids[i].pos[1]+(e.kids[s].pos[1]-e.kids[i].pos[1])/2,e.kids[s].pos[0],e.kids[s].pos[1],e.kids[s].pos[0]+(e.kids[o].pos[0]-e.kids[s].pos[0])/2,e.kids[s].pos[1]+(e.kids[o].pos[1]-e.kids[s].pos[1])/2];stroke("node"==t.stroke?e.kids[s].stroke:t.stroke),strokeWeight(e.kids[s].weight*t.weightMult+t.weightAdd),bezier(r[0],r[1],r[2],r[3],r[2],r[3],r[4],r[5])}}else if("polygon"==t.type){if(e.kids.length>1)for(let s=1;s<e.kids.length;s++)stroke("node"==t.stroke?e.kids[s].stroke:t.stroke),strokeWeight(e.kids[s].weight*t.weightMult+t.weightAdd),line(e.kids[s-1].pos[0],e.kids[s-1].pos[1],e.kids[s].pos[0],e.kids[s].pos[1])}else if("tree"==t.type)for(let s=0;s<e.kids.length;s++)stroke("node"==t.stroke?e.kids[s].stroke:t.stroke),strokeWeight(e.kids[s].weight*t.weightMult+t.weightAdd),line(e.kids[s].anchor.pos[0],e.kids[s].anchor.pos[1],e.kids[s].pos[0],e.kids[s].pos[1]);else if("circles"==t.type)for(let s=0;s<e.kids.length;s++){let i=e.kids[s].size*t.sizeMult+t.sizeAdd;fill("node"==t.fill?e.kids[s].fill:t.fill),stroke("node"==t.stroke?e.kids[s].stroke:t.stroke),strokeWeight(e.kids[s].weight*t.weightMult+t.weightAdd),ellipse(e.kids[s].pos[0],e.kids[s].pos[1],i,i)}else if("star"==t.type){if(e.kids.length>1)for(let s=1;s<e.kids.length;s++)stroke("node"==t.stroke?e.kids[s].stroke:t.stroke),strokeWeight(e.kids[s].weight*t.weightMult+t.weightAdd),bezier(e.kids[s-1].pos[0],e.kids[s-1].pos[1],e.pos[0],e.pos[1],e.pos[0],e.pos[1],e.kids[s].pos[0],e.kids[s].pos[1])}else if("umbrella"==t.type){if(e.kids.length>1)for(let s=1;s<e.kids.length;s++){let i=[(e.kids[s-1].pos[0]-e.kids[s].pos[0])/2,(e.kids[s-1].pos[1]-e.kids[s].pos[1])/2],o=[e.kids[s].pos[0]+i[0]-i[1],e.kids[s].pos[1]+i[1]+i[0]];stroke("node"==t.stroke?e.kids[s].stroke:t.stroke),strokeWeight(e.kids[s].weight*t.weightMult+t.weightAdd),bezier(e.kids[s].pos[0],e.kids[s].pos[1],o[0],o[1],o[0],o[1],e.kids[s-1].pos[0],e.kids[s-1].pos[1])}}else if("snake"==t.type){if(e.kids.length>1)for(let s=1;s<e.kids.length;s++){let i=[(e.kids[s-1].pos[0]-e.kids[s].pos[0])/2,(e.kids[s-1].pos[1]-e.kids[s].pos[1])/2],o=[e.kids[s].pos[0]+i[0]-i[1],e.kids[s].pos[1]+i[1]+i[0],e.kids[s].pos[0]+i[0]+i[1],e.kids[s].pos[1]+i[1]-i[0]];stroke("node"==t.stroke?e.kids[s].stroke:t.stroke),strokeWeight(e.kids[s].weight*t.weightMult+t.weightAdd),bezier(e.kids[s].pos[0],e.kids[s].pos[1],o[0],o[1],o[2],o[3],e.kids[s-1].pos[0],e.kids[s-1].pos[1])}}else if("petals"==t.type){if(e.kids.length>1)for(let s=1;s<e.kids.length;s++){let i=[(e.kids[s-1].pos[0]-e.kids[s].pos[0])/2,(e.kids[s-1].pos[1]-e.kids[s].pos[1])/2],o=[e.kids[s].pos[0]+i[0]-i[1],e.kids[s].pos[1]+i[1]+i[0],e.kids[s].pos[0]+i[0]+i[1],e.kids[s].pos[1]+i[1]-i[0]];stroke("node"==t.stroke?e.kids[s].stroke:t.stroke),strokeWeight(e.kids[s].weight*t.weightMult+t.weightAdd),fill("node"==t.fill?e.kids[s].fill:t.fill),bezier(o[0],o[1],e.kids[s-1].pos[0],e.kids[s-1].pos[1],e.kids[s-1].pos[0],e.kids[s-1].pos[1],o[2],o[3]),bezier(o[0],o[1],e.kids[s].pos[0],e.kids[s].pos[1],e.kids[s].pos[0],e.kids[s].pos[1],o[2],o[3])}}else if("daisy"==t.type&&e.kids.length>2)for(let s=1;s<e.kids.length-1;s++){let i=[e.kids[s].pos[0]+(e.kids[s-1].pos[0]-e.kids[s].pos[0])/2,e.kids[s].pos[1]+(e.kids[s-1].pos[1]-e.kids[s].pos[1])/2,e.kids[s].pos[0]+(e.kids[s+1].pos[0]-e.kids[s].pos[0])/2,e.kids[s].pos[1]+(e.kids[s+1].pos[1]-e.kids[s].pos[1])/2];stroke("node"==t.stroke?e.kids[s].stroke:t.stroke),strokeWeight(e.kids[s].weight*t.weightMult+t.weightAdd),fill("node"==t.fill?e.kids[s].fill:t.fill),bezier(e.pos[0],e.pos[1],i[0],i[1],i[0],i[1],e.kids[s].pos[0],e.kids[s].pos[1]),bezier(e.pos[0],e.pos[1],i[2],i[3],i[2],i[3],e.kids[s].pos[0],e.kids[s].pos[1])}for(let s of e.kids)this.renderNode(s,t)}}
//# sourceMappingURL=maps/bundle-min.js.map
