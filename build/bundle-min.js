var seed,density,render,canvas,editor,tickers=new Set,t=0,go=!0,graphs=[],def={props:{render:"curves",renderConfig:{type:"petals",levels:[["#FFCC0088",8],["rgba(255, 0, 0, 0.1)",4]]}},net:{type:"fan",num:35,pos:[500,400],ang:0,step:{ease:"sine",pow:-3,terms:"noise*0.8+t*0.2",min:30,max:480,dur:200},turn:6.28/35,children:[]}};function setup(){(canvas=createCanvas(windowWidth,windowHeight)).parent("container"),background("#FFFFFF"),stroke(0,128),strokeWeight(3),noFill(),smooth(),reset(),console.log("setup")}function reset(){background("#FFFFFF"),t=0,seed=int(random(999999)),randomSeed(seed),noiseSeed(seed),graphs=[];let e=generate();var s=new Graph(e);graphs.push(s),render=new RenderCurves(e),editor=select("#editor"),select("#editor-area").value(JSON.stringify(e,replacer,2))}function replacer(e,s){return"number"==typeof s?Math.floor(100*s)/100:s}function generate(){let e=0,s={props:{render:"curves",renderConfig:{type:"tree",levels:[[0,8],["#FFFFFF",4]]}},net:[]},t=s.net,i=1;for(;e<96;){let s=Math.floor(10*Math.pow(Math.random(),2))+2;for(;e+i*s>120&&s>1;)s--,console.log(s,i,e);let o={num:s,type:Math.random()<.6?"fan":"chain",step:{min:120*Math.random()+30,dif:0},turn:{min:PI/2,dif:TWO_PI},mirror:s%2==0,children:[]};t.push(o),e+=i*s,Math.random()<.7?(console.log("child",s,i,e),t=o.children,i*=s):console.log("sibling",s,i,e)}return s.net[0].pos=[windowWidth/2,windowHeight/2],console.log(e,s),s}function draw(){if(go){background("#FFFFFF");for(let e of graphs)moveNode(e.root),render.render(e.root);t++}}function makeGroup(e,s,t){for(let i=0;i<e.num;i++){let o=new Node;if(o.ix=i,o.nrm=1==e.num?0:1/e.num*i,o.parent=s,o.parent.kids.push(o),o.depth=s.depth+1,t.count++,t.depth=Math.max(t.depth,o.depth),"chain"==e.type&&i>0?o.anchor=o.parent.kids[i-1]:o.anchor=s,o.turn=isNaN(e.turn)?parseCurve(e.turn,o):e.turn,o.rot=0,o.step=isNaN(e.step)?parseCurve(e.step,o):e.step,e.children)for(let s=0;s<e.children.length;s++)makeGroup(e.children[s],o,t)}}class Graph{constructor(e={}){this.ix=graphs.length,this.count=0,this.depth=0,this.root=new Node;for(let s=0;s<e.net.length;s++)makeGroup(e.net[s],this.root,this);console.log("graph",this)}}class Node{constructor(e={}){this.ix=e.ix||0,this.nrm=e.nrm||0,this.rnd=e.rnd||Math.random(),this.pos=e.pos||[windowWidth/2,windowHeight/2],this.step=e.step||30,this.turn=e.turn||0,this.rot=e.rot||0,this.mirrot=e.mirror||!1,this.size=e.size||20,this.weight=e.weight||1,this.depth=e.depth||0,this.parent=e.parent||null,this.anchor=e.anchor||null,this.kids=e.kids||[]}}function ease(e,s,t){return"simple"==e?t<0?1-Math.pow(1-s,Math.abs(t)):Math.pow(s,Math.abs(t)):"IO"==e?s<.5?.5*(t<0?1-Math.pow(1-2*s,Math.abs(t)):Math.pow(2*s,Math.abs(t))):.5*(1-(t<0?1-Math.pow(1-(1-2*(s-.5)),Math.abs(t)):Math.pow(1-2*(s-.5),Math.abs(t))))+.5:"hill"==e?(s=s<.5?2*s:1-2*(s-.5),t<0?1-Math.pow(1-s,Math.abs(t)):Math.pow(s,Math.abs(t))):"sine"==e?.5*Math.sin(s*t*Math.PI*2)+.5:"noise"==e?noise(16*s):s}function mousePressed(){}function keyTyped(){if(" "===key)go=!go,console.log("go",go);else if("r"===key)reset();else if("s"===key){let e=getTime();saveCanvas("collider-"+e+".jpg"),saveJSON(defs,"collider-"+e+".jpg",!1)}else"g"===key?generate():"e"===key&&("block"==editor.style("display")?editor.hide():editor.show())}function contrast(e,s){return constrain(s*(e-.5)+.5,0,1)}function getTime(){let e=new Date;return e.getFullYear().toString().substring(2,4)+(e.getMonth()+1).toString().padStart(2,"0")+e.getDate().toString().padStart(2,"0")+"-"+e.getHours().toString().padStart(2,"0")+e.getMinutes().toString().padStart(2,"0")+e.getSeconds().toString().padStart(2,"0")}function windowResized(){resizeCanvas(windowWidth,windowHeight),canvas.parent("container"),background("#FFFFFF")}function parseCurve(e,s){e.terms=e.terms||"ix";let t={};t.ease=e.ease||"none",t.pow=e.pow||2,t.min=e.min||0,t.dif=e.dif||0,t.dur=e.dur||0,t.base=0,t.time=0;let i=e.terms.split("+");for(let e of i){let i=e.split("*");if("t"==i[0]||"time"==i[0])t.time=i.length>1?parseFloat(i[1]):1;else{let e=1;for(let t of i)e*="ix"==t?s.nrm:"rnd"==t?s.rnd:"noise"==t?noise(s.parent.nrm,s.nrm):"dix"==t?s.parent.nrm:"drnd"==t?s.parent.rnd:parseFloat(t);t.base+=e}}return t}function moveNode(e){if(null!==e.anchor){let s;if(isNaN(e.turn)){let i=e.turn.base;e.turn.dur>0&&(i+=1/e.turn.dur*(t%(e.turn.dur+1))*e.turn.time),i%=1,s=e.parent.rot+(e.turn.min+ease(e.turn.ease,i,e.turn.pow)*e.turn.dif)}else s=e.parent.rot+e.turn*e.ix;let i,o=int(null!=e.parent.anchor&&e.parent.mirror&&e.parent.anchor.ix%2==0)^int(e.mirror&&e.parent.ix%2==0);if(e.rot=o?e.parent.rot-s:e.parent.rot+s,isNaN(e.step)){let s=e.step.base;e.step.dur>0&&(s+=1/e.step.dur*(t%(e.step.dur+1))*e.step.time),s%=1,i=e.step.min+ease(e.step.ease,s,e.step.pow)*e.step.dif}else i=e.step;e.pos=[e.anchor.pos[0]+i*cos(e.rot),e.anchor.pos[1]+i*sin(e.rot)]}for(let s of e.kids)moveNode(s)}function drawNode(e){null!=e.anchor&&line(e.anchor.pos[0],e.anchor.pos[1],e.pos[0],e.pos[1]),ellipse(e.pos[0],e.pos[1],10,10);for(let s of e.kids)drawNode(s)}class RenderCurves{constructor(e={}){let s=e.props.renderConfig||{};this.type=s.type||"star",this.levels=s.levels||[[0,1,1]]}render(e){for(let s of this.levels)this.renderNode(e,s)}renderNode(e,s){if(stroke(s[0]),strokeWeight((e.depth+1)*s[1]),"bezier"==this.type){if(e.kids.length>2)for(let s=1;s<e.kids.length-1;s++){let t=[e.kids[s-1].pos[0]+(e.kids[s].pos[0]-e.kids[s-1].pos[0])/2,e.kids[s-1].pos[1]+(e.kids[s].pos[1]-e.kids[s-1].pos[1])/2,e.kids[s].pos[0],e.kids[s].pos[1],e.kids[s].pos[0]+(e.kids[s+1].pos[0]-e.kids[s].pos[0])/2,e.kids[s].pos[1]+(e.kids[s+1].pos[1]-e.kids[s].pos[1])/2];bezier(t[0],t[1],t[2],t[3],t[2],t[3],t[4],t[5])}}else if("bezier-closed"==this.type){if(e.kids.length>2)for(let s=0;s<e.kids.length;s++){let t=0==s?e.kids.length-1:s-1,i=s==e.kids.length-1?0:s+1,o=[e.kids[t].pos[0]+(e.kids[s].pos[0]-e.kids[t].pos[0])/2,e.kids[t].pos[1]+(e.kids[s].pos[1]-e.kids[t].pos[1])/2,e.kids[s].pos[0],e.kids[s].pos[1],e.kids[s].pos[0]+(e.kids[i].pos[0]-e.kids[s].pos[0])/2,e.kids[s].pos[1]+(e.kids[i].pos[1]-e.kids[s].pos[1])/2];bezier(o[0],o[1],o[2],o[3],o[2],o[3],o[4],o[5])}}else if("polygon"==this.type){if(e.kids.length>1)for(let s=1;s<e.kids.length;s++)line(e.kids[s-1].pos[0],e.kids[s-1].pos[1],e.kids[s].pos[0],e.kids[s].pos[1])}else if("tree"==this.type)for(let s=0;s<e.kids.length;s++)line(e.pos[0],e.pos[1],e.kids[s].pos[0],e.kids[s].pos[1]);else if("circles"==this.type)for(let s=0;s<e.kids.length;s++)ellipse(e.kids[s].pos[0],e.kids[s].pos[1],e.kids[s].size,e.kids[s].size);else if("star"==this.type){if(e.kids.length>1)for(let s=1;s<e.kids.length;s++)bezier(e.kids[s-1].pos[0],e.kids[s-1].pos[1],e.pos[0],e.pos[1],e.pos[0],e.pos[1],e.kids[s].pos[0],e.kids[s].pos[1])}else if("umbrella"==this.type){if(e.kids.length>1)for(let s=1;s<e.kids.length;s++){let t=[(e.kids[s-1].pos[0]-e.kids[s].pos[0])/2,(e.kids[s-1].pos[1]-e.kids[s].pos[1])/2],i=[e.kids[s].pos[0]+t[0]-t[1],e.kids[s].pos[1]+t[1]+t[0]];bezier(e.kids[s].pos[0],e.kids[s].pos[1],i[0],i[1],i[0],i[1],e.kids[s-1].pos[0],e.kids[s-1].pos[1])}}else if("snake"==this.type){if(e.kids.length>1)for(let s=1;s<e.kids.length;s++){let t=[(e.kids[s-1].pos[0]-e.kids[s].pos[0])/2,(e.kids[s-1].pos[1]-e.kids[s].pos[1])/2],i=[e.kids[s].pos[0]+t[0]-t[1],e.kids[s].pos[1]+t[1]+t[0],e.kids[s].pos[0]+t[0]+t[1],e.kids[s].pos[1]+t[1]-t[0]];bezier(e.kids[s].pos[0],e.kids[s].pos[1],i[0],i[1],i[2],i[3],e.kids[s-1].pos[0],e.kids[s-1].pos[1])}}else if("petals"==this.type&&e.kids.length>1)for(let s=1;s<e.kids.length;s++){let t=[(e.kids[s-1].pos[0]-e.kids[s].pos[0])/2,(e.kids[s-1].pos[1]-e.kids[s].pos[1])/2],i=[e.kids[s].pos[0]+t[0]-t[1],e.kids[s].pos[1]+t[1]+t[0],e.kids[s].pos[0]+t[0]+t[1],e.kids[s].pos[1]+t[1]-t[0]];bezier(i[0],i[1],e.kids[s-1].pos[0],e.kids[s-1].pos[1],e.kids[s-1].pos[0],e.kids[s-1].pos[1],i[2],i[3]),bezier(i[0],i[1],e.kids[s].pos[0],e.kids[s].pos[1],e.kids[s].pos[0],e.kids[s].pos[1],i[2],i[3])}for(let t of e.kids)this.renderNode(t,s)}}
//# sourceMappingURL=maps/bundle-min.js.map
