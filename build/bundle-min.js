var seed,density,render,canvas,editor,area,tickers=new Set,t=0,go=!0,tweenable=["step","turn","size","weight"],graphs=[],def0={props:{render:"curves",renderConfig:{type:"petals",levels:[["#FFCC0088",8],["rgba(255, 0, 0, 0.1)",4]]}},net:{type:"fan",num:35,pos:[500,400],ang:0,step:{ease:"sine",pow:-3,terms:"noise*0.8+t*0.2",min:30,max:480,dur:200},turn:6.28/35,children:[]}},def={props:{render:{type:"tree",levels:[{type:"circles",size:1.2,fill:"#666666",stroke:0,weight:1},{type:"circles",size:1,fill:"#FFFFFF",stroke:0,weight:1},{stroke:0,weight:1.5,type:"tree",fill:"#888888",size:1},{stroke:"#FFFFFF",weight:1,type:"tree",fill:"#888888",size:1}]}},net:[{num:2,type:"fan",step:{min:124.75,dif:0,terms:"ix"},turn:{min:1.57,dif:6.28,terms:"ix"},mirror:!1,weight:2,size:{min:10,dif:40,terms:"depth"},children:[{num:3,type:"fan",step:{min:142.94,dif:0,terms:"ix"},turn:{min:1.57,dif:6.28,terms:"ix"},mirror:!1,weight:2,size:{min:10,dif:40,terms:"depth"},children:[{num:4,type:"fan",step:{min:51.87,dif:0,terms:"ix"},turn:{min:1.57,dif:6.28,terms:"ix"},mirror:!1,weight:2,size:{min:10,dif:40,terms:"depth"},children:[]}]}],pos:[702.5,503.5]}]};function setup(){(canvas=createCanvas(windowWidth,windowHeight)).parent("container"),background("#FFFFFF"),stroke(0,128),strokeWeight(3),noFill(),smooth(),editor=select("#editor"),area=select("#editor-area"),select("#update").mouseClicked(function(){reset(!0)}),select("#generate").mouseClicked(function(){reset(!1)}),reset(!1),console.log("setup")}function reset(e){let s;s=e?JSON.parse(area.value()):def,background("#FFFFFF"),t=0,seed=int(random(999999)),randomSeed(seed),noiseSeed(seed),graphs=[];var i=new Graph(s);graphs.push(i),render=new RenderCurves(s),area.value(JSON.stringify(s,replacer,2))}function replacer(e,s){return"number"==typeof s?Math.floor(100*s)/100:s}function generate(){let e=0,s={props:{render:{type:"tree",levels:[{type:"circles",size:1.2,fill:"#666666"},{type:"circles",size:1,fill:"#FFFFFF"},{stroke:0,weight:1.5},{stroke:"#FFFFFF",weight:1}]}},net:[]},t=s.net,i=1;for(;e<16;){let s=Math.floor(10*Math.pow(Math.random(),2))+2;for(;e+i*s>20&&s>1;)s--;let r={num:s,type:Math.random()<.6?"fan":"chain",step:{min:120*Math.random()+30,dif:0},turn:{min:PI/2,dif:TWO_PI},mirror:s%2==0,weight:2,size:{min:10,dif:40,terms:"depth"},children:[]};t.push(r),e+=i*s,Math.random()<.7&&(t=r.children,i*=s)}return s.net[0].pos=[windowWidth/2,windowHeight/2],s}function draw(){if(go){background("#FFFFFF");for(let e of graphs)e.root.update(),moveNode(e.root),render.render(e.root);t++}}function makeGroup(e,s,t){for(let i=0;i<e.num;i++){let r=new Node;if(r.ix=i,r.nrm=1==e.num?0:1/e.num*i,r.parent=s,r.parent.kids.push(r),r.depth=s.depth+1,r.graph=t,t.count++,t.depth=Math.max(t.depth,r.depth),"chain"==e.type&&i>0?r.anchor=s.kids[i-1]:r.anchor=s,r.type=e.type,r.rot=0,r.turn=e.turn,r.step=e.step,r.mirror=e.mirror,r.size=e.size,r.weight=e.weight,r.fill=e.fill,r.stroke=e.stroke,r.init(),e.children)for(let s=0;s<e.children.length;s++)makeGroup(e.children[s],r,t)}}class Graph{constructor(e={}){this.ix=graphs.length,this.count=0,this.depth=0,this.root=new Node;for(let s=0;s<e.net.length;s++)makeGroup(e.net[s],this.root,this);this.root.init(),console.log("graph",this)}}class Node{constructor(e={}){this.ix=e.ix||0,this.nrm=e.nrm||0,this.rnd=e.rnd||Math.random(),this.pos=e.pos||[windowWidth/2,windowHeight/2],this.step=e.step||30,this.turn=e.turn||0,this.rot=e.rot||0,this.mirror=e.mirror||!1,this.size=e.size||20,this.weight=e.weight||1,this.depth=e.depth||0,this.fill=e.fill||"#888888",this.stroke=e.stroke||0,this.graph=e.graph||null,this.parent=e.parent||null,this.anchor=e.anchor||null,this.kids=e.kids||[],this.curves={}}init(){for(let e of tweenable)isNaN(this[e])&&(this.curves[e]=parseCurve(this[e],this));for(let e of this.kids)e.init()}update(){for(let[e,s]of Object.entries(this.curves)){let i=s.base;s.dur>0&&(i+=1/s.dur*(t%(s.dur+1))*s.time),i>1&&(i%=1),this[e]=s.min+ease(s.ease,i,s.pow)*s.dif}for(let e of this.kids)e.update()}}function ease(e,s,t){return"simple"==e?t<0?1-Math.pow(1-s,Math.abs(t)):Math.pow(s,Math.abs(t)):"IO"==e?s<.5?.5*(t<0?1-Math.pow(1-2*s,Math.abs(t)):Math.pow(2*s,Math.abs(t))):.5*(1-(t<0?1-Math.pow(1-(1-2*(s-.5)),Math.abs(t)):Math.pow(1-2*(s-.5),Math.abs(t))))+.5:"hill"==e?(s=s<.5?2*s:1-2*(s-.5),t<0?1-Math.pow(1-s,Math.abs(t)):Math.pow(s,Math.abs(t))):"sine"==e?.5*Math.sin(s*t*Math.PI*2)+.5:"noise"==e?noise(16*s):s}function mousePressed(){}function keyTyped(){if(document.activeElement!==document.getElementById("editor-area"))if(" "===key)go=!go,console.log("go",go);else if("r"===key)reset(!1);else if("s"===key){let e=getTime();saveCanvas("collider-"+e+".jpg"),saveJSON(defs,"collider-"+e+".jpg",!1)}else"g"===key?generate():"e"===key&&("block"==editor.style("display")?editor.hide():editor.show())}function contrast(e,s){return constrain(s*(e-.5)+.5,0,1)}function getTime(){let e=new Date;return e.getFullYear().toString().substring(2,4)+(e.getMonth()+1).toString().padStart(2,"0")+e.getDate().toString().padStart(2,"0")+"-"+e.getHours().toString().padStart(2,"0")+e.getMinutes().toString().padStart(2,"0")+e.getSeconds().toString().padStart(2,"0")}function windowResized(){resizeCanvas(windowWidth,windowHeight),canvas.parent("container"),background("#FFFFFF")}function parseCurve(e,s){e.terms=e.terms||"ix";let t={};t.ease=e.ease||"none",t.pow=e.pow||2,t.min=e.min||0,t.dif=e.dif||0,t.dur=e.dur||0,t.base=0,t.time=0;let i=e.terms.split("+");for(let e of i){let i=e.split("*");if("t"==i[0]||"time"==i[0])t.time=i.length>1?parseFloat(i[1]):1;else{let e=1;for(let t of i)e*="ix"==t?s.nrm:"rnd"==t?s.rnd:"noise"==t?noise(s.parent.nrm,s.nrm):"dix"==t?s.parent.nrm:"drnd"==t?s.parent.rnd:"depth"==t?1==s.graph.depth?0:1/s.graph.depth*s.depth:"idepth"==t?1==s.graph.depth?1:1-1/s.graph.depth*s.depth:parseFloat(t);t.base+=e}}return t}function moveNode(e){if(null!==e.anchor){let s=(null!=e.parent.anchor&&e.parent.mirror&&e.parent.anchor.ix%2==0)^(e.mirror&&e.parent.ix%2==0);e.rot=s?e.parent.rot-e.turn:e.parent.rot+e.turn,e.pos=[e.anchor.pos[0]+e.step*cos(e.rot),e.anchor.pos[1]+e.step*sin(e.rot)]}for(let s of e.kids)moveNode(s)}function drawNode(e){null!=e.anchor&&line(e.anchor.pos[0],e.anchor.pos[1],e.pos[0],e.pos[1]),ellipse(e.pos[0],e.pos[1],10,10);for(let s of e.kids)drawNode(s)}class RenderCurves{constructor(e={}){let s=e.props.render||{};this.type=s.type||"tree",this.levels=s.levels||[{stroke:0,weight:1}];for(let e of this.levels)e.hasOwnProperty("type")||(e.type=this.type),e.hasOwnProperty("stroke")||(e.stroke=0),e.hasOwnProperty("fill")||(e.fill="#888888"),e.hasOwnProperty("weight")||(e.weight=1),e.hasOwnProperty("size")||(e.size=1)}render(e){for(let s of this.levels)this.renderNode(e,s)}renderNode(e,s){if("bezier"==s.type){if(e.kids.length>2)for(let t=1;t<e.kids.length-1;t++){let i=[e.kids[t-1].pos[0]+(e.kids[t].pos[0]-e.kids[t-1].pos[0])/2,e.kids[t-1].pos[1]+(e.kids[t].pos[1]-e.kids[t-1].pos[1])/2,e.kids[t].pos[0],e.kids[t].pos[1],e.kids[t].pos[0]+(e.kids[t+1].pos[0]-e.kids[t].pos[0])/2,e.kids[t].pos[1]+(e.kids[t+1].pos[1]-e.kids[t].pos[1])/2];stroke("node"==s.stroke?e.kids[t].stroke:s.stroke),strokeWeight(e.kids[t].weight*s.weight),bezier(i[0],i[1],i[2],i[3],i[2],i[3],i[4],i[5])}}else if("bezier-closed"==s.type){if(e.kids.length>2)for(let t=0;t<e.kids.length;t++){let i=0==t?e.kids.length-1:t-1,r=t==e.kids.length-1?0:t+1,o=[e.kids[i].pos[0]+(e.kids[t].pos[0]-e.kids[i].pos[0])/2,e.kids[i].pos[1]+(e.kids[t].pos[1]-e.kids[i].pos[1])/2,e.kids[t].pos[0],e.kids[t].pos[1],e.kids[t].pos[0]+(e.kids[r].pos[0]-e.kids[t].pos[0])/2,e.kids[t].pos[1]+(e.kids[r].pos[1]-e.kids[t].pos[1])/2];stroke("node"==s.stroke?e.kids[t].stroke:s.stroke),strokeWeight(e.kids[t].weight*s.weight),bezier(o[0],o[1],o[2],o[3],o[2],o[3],o[4],o[5])}}else if("polygon"==s.type){if(e.kids.length>1)for(let t=1;t<e.kids.length;t++)stroke("node"==s.stroke?e.kids[t].stroke:s.stroke),strokeWeight(e.kids[t].weight*s.weight),line(e.kids[t-1].pos[0],e.kids[t-1].pos[1],e.kids[t].pos[0],e.kids[t].pos[1])}else if("tree"==s.type)for(let t=0;t<e.kids.length;t++)stroke("node"==s.stroke?e.kids[t].stroke:s.stroke),strokeWeight(e.kids[t].weight*s.weight),line(e.kids[t].anchor.pos[0],e.kids[t].anchor.pos[1],e.kids[t].pos[0],e.kids[t].pos[1]);else if("circles"==s.type)for(let t=0;t<e.kids.length;t++){let i=e.kids[t].size*s.size;fill("node"==s.fill?e.kids[t].fill:s.fill),noStroke(),ellipse(e.kids[t].pos[0],e.kids[t].pos[1],i,i)}else if("star"==s.type){if(e.kids.length>1)for(let s=1;s<e.kids.length;s++)bezier(e.kids[s-1].pos[0],e.kids[s-1].pos[1],e.pos[0],e.pos[1],e.pos[0],e.pos[1],e.kids[s].pos[0],e.kids[s].pos[1])}else if("umbrella"==s.type){if(e.kids.length>1)for(let s=1;s<e.kids.length;s++){let t=[(e.kids[s-1].pos[0]-e.kids[s].pos[0])/2,(e.kids[s-1].pos[1]-e.kids[s].pos[1])/2],i=[e.kids[s].pos[0]+t[0]-t[1],e.kids[s].pos[1]+t[1]+t[0]];bezier(e.kids[s].pos[0],e.kids[s].pos[1],i[0],i[1],i[0],i[1],e.kids[s-1].pos[0],e.kids[s-1].pos[1])}}else if("snake"==s.type){if(e.kids.length>1)for(let s=1;s<e.kids.length;s++){let t=[(e.kids[s-1].pos[0]-e.kids[s].pos[0])/2,(e.kids[s-1].pos[1]-e.kids[s].pos[1])/2],i=[e.kids[s].pos[0]+t[0]-t[1],e.kids[s].pos[1]+t[1]+t[0],e.kids[s].pos[0]+t[0]+t[1],e.kids[s].pos[1]+t[1]-t[0]];bezier(e.kids[s].pos[0],e.kids[s].pos[1],i[0],i[1],i[2],i[3],e.kids[s-1].pos[0],e.kids[s-1].pos[1])}}else if("petals"==s.type&&e.kids.length>1)for(let s=1;s<e.kids.length;s++){let t=[(e.kids[s-1].pos[0]-e.kids[s].pos[0])/2,(e.kids[s-1].pos[1]-e.kids[s].pos[1])/2],i=[e.kids[s].pos[0]+t[0]-t[1],e.kids[s].pos[1]+t[1]+t[0],e.kids[s].pos[0]+t[0]+t[1],e.kids[s].pos[1]+t[1]-t[0]];bezier(i[0],i[1],e.kids[s-1].pos[0],e.kids[s-1].pos[1],e.kids[s-1].pos[0],e.kids[s-1].pos[1],i[2],i[3]),bezier(i[0],i[1],e.kids[s].pos[0],e.kids[s].pos[1],e.kids[s].pos[0],e.kids[s].pos[1],i[2],i[3])}for(let t of e.kids)this.renderNode(t,s)}}
//# sourceMappingURL=maps/bundle-min.js.map
